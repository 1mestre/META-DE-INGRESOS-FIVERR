<!DOCTYPE html>

<html lang="es">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Mi vida</title>



Â  Â  <link rel="apple-touch-icon" sizes="180x180" href="/Vida_Sebas/apple-touch-icon.png">

Â  Â  <link rel="icon" type="image/png" sizes="32x32" href="/Vida_Sebas/favicon-32x32.png">

Â  Â  <link rel="icon" type="image/png" sizes="16x16" href="/Vida_Sebas/favicon-16x16.png">

Â  Â  <link rel="manifest" href="/Vida_Sebas/site.webmanifest">



Â  Â  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">

Â  Â  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/main.min.css' rel='stylesheet' />

Â  Â  <style>

Â  Â  Â  Â  :root {

Â  Â  Â  Â  Â  Â  --bg-dark: #181a1f;Â 

Â  Â  Â  Â  Â  Â  --bg-card: #22252e;Â 

Â  Â  Â  Â  Â  Â  --bg-card-light: #2a2e37;

Â  Â  Â  Â  Â  Â  --text-primary: #f0f0f0;Â 

Â  Â  Â  Â  Â  Â  --text-secondary: #b0b0b0;Â 

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  --accent-green-medium: #50fa7b;Â 

Â  Â  Â  Â  Â  Â  --accent-green-neon: #39ff14;Â  Â 

Â  Â  Â  Â  Â  Â  --accent-yellow-pale: #f1fa8c;Â Â 

Â  Â  Â  Â  Â  Â  --accent-yellow-green: #c3e08d;Â 

Â  Â  Â  Â  Â  Â  --accent-blue-info: #8be9fd;Â  Â 

Â  Â  Â  Â  Â  Â  --accent-red-clear: #ff5555;Â  Â 

Â  Â  Â  Â  Â  Â  --accent-gold: #ffd700;Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  --accent-pink: #ff79c6;

Â  Â  Â  Â  Â  Â  --accent-purple: #bd93f9;

Â  Â  Â  Â  Â  Â  --accent-orange: #ffb86c;



Â  Â  Â  Â  Â  Â  /* Variables de color para degradados */

Â  Â  Â  Â  Â  Â  --green-dark: #2f9e4f;

Â  Â  Â  Â  Â  Â  --blue-dark: #1c7ed6;

Â  Â  Â  Â  Â  Â  --orange-dark: #e8590c;

Â  Â  Â  Â  Â  Â  --red-dark: #c92a2a;



Â  Â  Â  Â  Â  Â  --pastel-green-celebration: #a7f3d0;Â 

Â  Â  Â  Â  Â  Â  --celebration-overall-bg: var(--pastel-green-celebration);Â 

Â  Â  Â  Â  Â  Â  --celebration-overall-text-color: #054228;Â 

Â  Â  Â  Â  Â  Â  --celebration-overall-glow: #6ee7b7;



Â  Â  Â  Â  Â  Â  --cal-progress-q1: var(--accent-red-clear);

Â  Â  Â  Â  Â  Â  --cal-progress-q2: var(--accent-orange);

Â  Â  Â  Â  Â  Â  --cal-progress-q3: var(--accent-yellow-green);

Â  Â  Â  Â  Â  Â  --cal-progress-q4: var(--accent-green-medium);

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  --monthly-time-progress-color: var(--accent-blue-info);Â 



Â  Â  Â  Â  Â  Â  --glow-color-blue-rgb: 139, 233, 253;Â 

Â  Â  Â  Â  Â  Â  --glow-color-green-rgb: 80, 250, 123;Â 

Â  Â  Â  Â  Â  Â  --glow-color-neutral-rgb: 70, 75, 85;Â 

Â  Â  Â  Â  Â  Â  --accent-red-clear-rgb: 255, 85, 85;Â 

Â  Â  Â  Â  Â  Â  --accent-green-neon-rgb: 57, 255, 20;

Â  Â  Â  Â  Â  Â  --accent-yellow-pale-rgb: 241, 250, 140;Â 

Â  Â  Â  Â  Â  Â  --accent-orange-rgb: 255, 184, 108;

Â  Â  Â  Â  Â  Â  --accent-yellow-green-rgb: 195, 224, 141;



Â  Â  Â  Â  Â  Â  --bg-card-rgb: 34, 37, 46;

Â  Â  Â  Â  Â  Â  --bg-card-light-rgb: 42, 46, 55;

Â  Â  Â  Â  Â  Â  --bg-dark-rgb: 24, 26, 31;

Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  --subject-default-text-color: var(--bg-dark);



Â  Â  Â  Â  Â  Â  --fc-border-color: rgba(var(--text-secondary), 0.3);

Â  Â  Â  Â  Â  Â  --fc-daygrid-event-dot-width: 8px;

Â  Â  Â  Â  Â  Â  --fc-event-text-color: var(--bg-dark);Â 

Â  Â  Â  Â  Â  Â  --fc-more-link-bg-color: var(--bg-card-light);

Â  Â  Â  Â  Â  Â  --fc-more-link-text-color: var(--text-secondary);

Â  Â  Â  Â  Â  Â  --fc-today-bg-color: transparent;Â 

Â  Â  Â  Â  Â  Â  --fc-page-bg-color: transparent;Â 

Â  Â  Â  Â  Â  Â  --fc-neutral-bg-color: rgba(var(--bg-card-light-rgb), 0.5);Â 

Â  Â  Â  Â  }



Â  Â  Â  Â  *{margin:0;padding:0;box-sizing:border-box}

Â  Â  Â  Â  html, body { height: 100%; width: 100%; overflow-x: hidden; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  body::before {

Â  Â  Â  Â  Â  Â  content: '';

Â  Â  Â  Â  Â  Â  position: fixed;

Â  Â  Â  Â  Â  Â  top: 0; left: 0;

Â  Â  Â  Â  Â  Â  width: 100%; height: 100%;

Â  Â  Â  Â  Â  Â  background-color: var(--bg-dark);

Â  Â  Â  Â  Â  Â  z-index: -1;

Â  Â  Â  Â  }

Â  Â  Â  Â  body{ font-family: 'Rubik', Arial, sans-serif; padding: 15px; background-color: transparent; color: var(--text-primary); display: flex; flex-direction: column; align-items: center; position: relative; }

Â  Â  Â  Â 

Â  Â  Â  Â  #loading-indicator {

Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;

Â  Â  Â  Â  Â  Â  background-color: rgba(var(--bg-dark-rgb), 0.9);

Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; align-items: center;

Â  Â  Â  Â  Â  Â  z-index: 9999; color: var(--accent-blue-info); font-size: 1.5em;

Â  Â  Â  Â  Â  Â  transition: opacity 0.5s ease;

Â  Â  Â  Â  }



Â  Â  Â  Â  .main-container { width: 100%; max-width: 1600px; display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; }

Â  Â  Â  Â  .main-navigation { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; padding: 15px; background-color: rgba(var(--bg-card-rgb), 0.65); backdrop-filter: blur(18px) saturate(180%); -webkit-backdrop-filter: blur(18px) saturate(180%); border: 1px solid rgba(var(--text-primary), 0.15); border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.25); margin-bottom: 25px; width: 100%; max-width: 900px; position: sticky; top: 15px; z-index: 1000; }

Â  Â  Â  Â  .nav-button { background: var(--bg-card-light); color: var(--text-primary); border: 1px solid rgba(var(--text-primary), 0.1); padding: 10px 18px; border-radius: 10px; font-size: 0.9em; font-weight: 500; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }

Â  Â  Â  Â  .nav-button:hover { background: var(--accent-blue-info); color: var(--bg-dark); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(var(--glow-color-blue-rgb), 0.3); }

Â  Â  Â  Â  .nav-button.active {Â  background: var(--accent-green-neon); color: var(--bg-dark); box-shadow: 0 0 15px rgba(var(--accent-green-neon-rgb), 0.5); font-weight: 700; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .page-content {Â 

Â  Â  Â  Â  Â  Â  display: none;Â 

Â  Â  Â  Â  Â  Â  width: 100%;Â 

Â  Â  Â  Â  Â  Â  animation: fadeInPage 0.5s ease-out forwards;Â 

Â  Â  Â  Â  Â  Â  padding: 0 10px;Â 

Â  Â  Â  Â  Â  Â  transform: translateZ(0);

Â  Â  Â  Â  Â  Â  -webkit-transform: translateZ(0);

Â  Â  Â  Â  }

Â  Â  Â  Â  .page-content.active { display: block;Â  }

Â  Â  Â  Â  @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

Â  Â  Â  Â  .page-widget-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; width: 100%; }

Â  Â  Â  Â 

Â  Â  Â  Â  .widget-card {

Â  Â  Â  Â  Â  Â  background-color: rgba(var(--bg-card-light-rgb), 0.6);Â 

Â  Â  Â  Â  Â  Â  backdrop-filter: blur(18px) saturate(180%);Â 

Â  Â  Â  Â  Â  Â  -webkit-backdrop-filter: blur(18px) saturate(180%);

Â  Â  Â  Â  Â  Â  border: 1px solid rgba(var(--text-primary), 0.18);Â 

Â  Â  Â  Â  Â  Â  border-radius:20px; padding:25px; margin-bottom:25px;Â 

Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 25px rgba(var(--glow-color-neutral-rgb), 0.15), 0 5px 15px rgba(0,0,0,0.25);Â 

Â  Â  Â  Â  Â  Â  position: relative; z-index: 10;Â 

Â  Â  Â  Â  Â  Â  flex-grow: 0;Â 

Â  Â  Â  Â  Â  Â  flex-shrink: 1;Â 

Â  Â  Â  Â  Â  Â  flex-basis: auto;Â 

Â  Â  Â  Â  Â  Â  width: 100%;Â 

Â  Â  Â  Â  Â  Â  max-width: 1150px;

Â  Â  Â  Â  Â  Â  min-width: 300px;Â 

Â  Â  Â  Â  Â  Â  text-align:center;

Â  Â  Â  Â  Â  Â  display: flex;Â 

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  }

Â  Â  Â  Â  #ingresos-widget-main {Â 

Â  Â  Â  Â  Â  Â  max-width: 700px;

Â  Â  Â  Â  }

Â  Â  Â  Â  #mainCalendar {

Â  Â  Â  Â  Â  Â  flex-grow: 1;Â 

Â  Â  Â  Â  Â  Â  min-height: 500px;Â 

Â  Â  Â  Â  Â  Â  width: 100%;Â 

Â  Â  Â  Â  }



Â  Â  Â  Â  .placeholder-page h2, .university-timetable-widget h2, #ingresos-page .title, #calendario-page h2 { font-size: 1.8em; color: var(--accent-blue-info); margin-bottom: 20px; }

Â  Â  Â  Â  .placeholder-page p { font-size: 1.1em; color: var(--text-secondary); }

Â  Â  Â  Â  #ingresos-page .money-card.widget-card { padding: 18px; border-radius: 15px; margin-bottom: 0; max-width: none; }

Â  Â  Â  Â  #ingresos-page .current-month-display { padding: 8px 12px; border-radius: 10px; box-shadow: 0 0 10px rgba(var(--glow-color-blue-rgb), 0.15); margin-bottom: 15px; background-color: rgba(var(--bg-card-light-rgb), 0.85); color: var(--accent-blue-info); font-size: 1.1em; font-weight: 500;}Â 

Â  Â  Â  Â  #ingresos-page .title-container { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 5px; flex-wrap: wrap; }

Â  Â  Â  Â  #ingresos-page .target-input-group { display: flex; align-items: center; gap: 8px; background-color: rgba(var(--bg-card-light-rgb), 0.7); padding: 8px 12px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid rgba(var(--text-primary),0.1); }

Â  Â  Â  Â  #ingresos-page .target-input-group label { font-size: 0.9em; color: var(--text-secondary); }

Â  Â  Â  Â  #ingresos-page #overallTargetInput { width: 120px; padding: 6px 8px; border: 1px solid #4a505e; border-radius: 6px; background-color: var(--bg-dark); color: var(--text-primary); font-family: 'Rubik', sans-serif; text-align: right; font-size: 0.95em; }

Â  Â  Â  Â  #ingresos-page #overallTargetInput:focus { outline: none; border-color: var(--accent-blue-info); box-shadow: 0 0 8px rgba(var(--glow-color-blue-rgb),0.3); }

Â  Â  Â  Â  @keyframes slideInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }Â 

Â  Â  Â  Â  #ingresos-page .subtitle{Â  color: var(--text-secondary); font-size:1.1em; margin-bottom:25px; margin-top: 5px; font-weight: 500; animation: slideInUp 0.6s ease-out 0.4s backwards; }Â 

Â  Â  Â  Â  @keyframes slideInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }Â 

Â  Â  Â  Â  #ingresos-page .currency-selector-container { display: flex; align-items: center; justify-content: center; margin-bottom: 15px; gap: 10px; flex-wrap: wrap; } #ingresos-page .currency-selector-container label { font-size: 0.95em; color: var(--text-secondary); margin-right: 5px; } #ingresos-page #currencySelectorIngresos {Â  padding: 8px 12px; border-radius: 8px; border: 1px solid #4a505e; background-color: var(--bg-dark); color: var(--text-primary); font-family: 'Rubik', sans-serif; font-size: 0.95em; cursor: pointer; outline: none; } #ingresos-page #currencySelectorIngresos:focus { border-color: var(--accent-blue-info); box-shadow: 0 0 8px rgba(var(--glow-color-blue-rgb), 0.4); }

Â  Â  Â  Â  #ingresos-page .money-input{ width:100%; padding:14px; border:2px solid #4a505e; border-radius:12px; font-size:1.15em; text-align:center; margin-bottom:12px; background: var(--bg-dark); color: var(--text-primary); font-family: 'Rubik', sans-serif; transition: border-color 0.3s ease, box-shadow 0.3s ease; } #ingresos-page .money-input::placeholder { color: #888; }Â  #ingresos-page .money-input:focus{ outline:none; border-color: var(--accent-blue-info); box-shadow:0 0 12px rgba(var(--glow-color-blue-rgb), 0.5), 0 0 2px rgba(var(--glow-color-blue-rgb), 0.7);Â  } #ingresos-page .add-btn{Â  background:linear-gradient(135deg, var(--accent-green-medium), var(--accent-green-neon)); color: #111;Â  border:none; padding:14px 30px; border-radius:12px; font-size:1.05em; cursor:pointer; font-weight:700; transition:all 0.3s ease; animation: pulseButton 2s infinite ease-in-out 1s; box-shadow: 0 0 10px rgba(var(--accent-green-neon-rgb), 0.3);Â  width: 100%;Â  } #ingresos-page .add-btn:hover{ transform:translateY(-3px) scale(1.08); box-shadow:0 8px 20px rgba(var(--accent-green-neon-rgb), 0.4), 0 0 15px rgba(var(--accent-green-neon-rgb), 0.5) ; animation-play-state: paused; } #ingresos-page .add-btn:disabled { background: #4a4a4a; color: #888; cursor: not-allowed; animation: none; box-shadow: none; } @keyframes pulseButton { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }

Â  Â  Â  Â 

Â  Â  Â  Â  #ingresos-page .progress-container{margin:25px 0}Â 

Â  Â  Â  Â  #ingresos-page .progress-container.monthly .progress-bar-bg{ height: 30px; border-radius:30px; }Â 

Â  Â  Â  Â  #ingresos-page .progress-container.monthly .progress-bar{ height: 30px; border-radius:30px; }Â 

Â  Â  Â  Â  #ingresos-page .progress-bar-bg{ width:100%; height:22px; background: #3a3f4b; border-radius:22px; overflow:hidden; box-shadow:inset 0 2px 5px rgba(0,0,0,0.3); }Â 

Â  Â  Â  Â  #ingresos-page .progress-bar{Â 

Â  Â  Â  Â  Â  Â  height:100%;Â 

Â  Â  Â  Â  Â  Â  border-radius:22px;Â 

Â  Â  Â  Â  Â  Â  width:0%;Â 

Â  Â  Â  Â  Â  Â  transition:width 1.2s cubic-bezier(0.25, 0.1, 0.25, 1), background 1s ease, box-shadow 1s ease;Â 

Â  Â  Â  Â  Â  Â  position:relative;Â 

Â  Â  Â  Â  }

Â  Â  Â  Â 

Â  Â  Â  Â  #progressBarOverall {

Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, var(--green-dark), var(--accent-green-medium));

Â  Â  Â  Â  Â  Â  box-shadow: 0 0 12px 2px rgba(var(--glow-color-green-rgb), 0.4);

Â  Â  Â  Â  }



Â  Â  Â  Â  #progressBarMonthly {

Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, var(--blue-dark), var(--accent-blue-info));

Â  Â  Â  Â  Â  Â  box-shadow: 0 0 12px 2px rgba(var(--glow-color-blue-rgb), 0.4);

Â  Â  Â  Â  }



Â  Â  Â  Â  @keyframes shimmer {

Â  Â  Â  Â  Â  Â  0% { background-position: -800px 0; }

Â  Â  Â  Â  Â  Â  100% { background-position: 800px 0; }

Â  Â  Â  Â  }

Â  Â  Â  Â  #ingresos-page .progress-bar::before {

Â  Â  Â  Â  Â  Â  content:'';Â 

Â  Â  Â  Â  Â  Â  position:absolute;Â 

Â  Â  Â  Â  Â  Â  top:0;

Â  Â  Â  Â  Â  Â  left:0;Â 

Â  Â  Â  Â  Â  Â  height:100%;Â 

Â  Â  Â  Â  Â  Â  width:100%;Â 

Â  Â  Â  Â  Â  Â  background: linear-gradient(to right,Â 

Â  Â  Â  Â  Â  Â  Â  Â  transparent 0%,Â 

Â  Â  Â  Â  Â  Â  Â  Â  rgba(255,255,255,0.05) 40%,Â 

Â  Â  Â  Â  Â  Â  Â  Â  rgba(255,255,255,0.3) 50%,Â 

Â  Â  Â  Â  Â  Â  Â  Â  rgba(255,255,255,0.05) 60%,Â 

Â  Â  Â  Â  Â  Â  Â  Â  transparent 100%);

Â  Â  Â  Â  Â  Â  background-size: 800px 100%;

Â  Â  Â  Â  Â  Â  background-repeat: no-repeat;

Â  Â  Â  Â  Â  Â  animation: shimmer 3.5s infinite linear;Â 

Â  Â  Â  Â  Â  Â  border-radius:22px;

Â  Â  Â  Â  }



Â  Â  Â  Â  #ingresos-page .progress-text{ margin-top:12px; font-size:1.25em; font-weight:500; color: var(--text-primary); }Â 

Â  Â  Â  Â  #ingresos-page .progress-text.monthly-text { font-size: 1.1em; color: var(--text-secondary); }Â 

Â  Â  Â  Â 

Â  Â  Â  Â  #ingresos-page .money-display{ display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:18px; margin:25px 0; }Â 

Â  Â  Â  Â  #ingresos-page .money-card{ transition: transform 0.35s ease, box-shadow 0.35s ease; animation: popIn 0.5s ease-out backwards; padding: 18px; border-radius: 15px; margin-bottom: 0; }Â 

Â  Â  Â  Â  #ingresos-page .money-card:nth-child(1) { animation-delay: 0.5s; }Â  #ingresos-page .money-card:nth-child(2) { animation-delay: 0.6s; }Â  #ingresos-page .money-card:nth-child(3) { animation-delay: 0.7s; }Â  #ingresos-page .money-card:nth-child(4) { animation-delay: 0.8s; } @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } } #ingresos-page .money-card:hover{Â  transform: translateY(-5px) scale(1.02);Â  box-shadow: 0 6px 15px rgba(0,0,0,0.25), 0 0 20px rgba(var(--glow-color-neutral-rgb), 0.25);Â  } #ingresos-page .money-label{ color:var(--text-secondary); font-size:0.95em; margin-bottom:6px; font-weight:500; } #ingresos-page .money-value{ color:var(--text-primary); font-size:1.3em; font-weight:700; } #ingresos-page .total-accumulated-cop .money-value {color: var(--accent-green-medium)}Â  #ingresos-page .overall-target-cop .money-value {color: var(--accent-blue-info)}Â  #ingresos-page .overall-remaining-cop .money-value {color: var(--accent-yellow-green)}Â  #ingresos-page .current-month-usd-total .money-value {color: var(--accent-blue-info)}Â  #ingresos-page .overall-usd-total .money-value {color: var(--accent-gold)}Â  #ingresos-page .exchange-rate-info {font-size: 0.8em; color: var(--text-secondary); margin-top: 4px; font-weight: 400;} #ingresos-page .exchange-rate-source {font-size: 0.7em; color: #777; margin-top: 2px; display: none; }Â 

Â  Â  Â  Â  #ingresos-page .celebration-overall{ display:none; margin:20px 0; padding:20px; background: var(--celebration-overall-bg); border-radius:15px; font-size:1.4em; color: var(--celebration-overall-text-color); font-weight:700; animation:bounce 0.7s infinite alternate, celebrateGlowOverallAnim 1.2s infinite alternate; text-shadow: 0 0 8px rgba(0,0,0,0.1); box-shadow: 0 0 20px var(--celebration-overall-glow); position: relative; z-index: 15; }Â 

Â  Â  Â  Â  @keyframes bounce{from{transform:translateY(0) scale(1)}to{transform:translateY(-6px) scale(1.02)}} @keyframes celebrateGlowOverallAnim {Â  0% { box-shadow: 0 0 15px var(--celebration-overall-glow), 0 0 25px var(--celebration-overall-glow); }Â  100% { box-shadow: 0 0 30px var(--celebration-overall-glow), 0 0 45px var(--celebration-overall-glow), 0 0 10px #e0ffe0; }Â  } #ingresos-page .history, #ingresos-page .monthly-goals-section { margin-top:25px; text-align:left;Â  } #ingresos-page .history-title, #ingresos-page .monthly-goals-title { color:var(--text-primary); font-size:1.15em; font-weight:700; margin-bottom:15px; text-align:center; } #ingresos-page .history-list, #ingresos-page .monthly-goals-list { max-height:180px;Â  overflow-y:auto; background: rgba(var(--bg-dark-rgb), 0.8);Â  border-radius:12px; padding:15px;Â  scrollbar-width: thin; scrollbar-color: var(--accent-green-medium) rgba(var(--bg-card-light-rgb), 0.5); border: 1px solid rgba(var(--text-primary), 0.1); } #ingresos-page .history-list::-webkit-scrollbar, #ingresos-page .monthly-goals-list::-webkit-scrollbar { width: 8px; } #ingresos-page .history-list::-webkit-scrollbar-track, #ingresos-page .monthly-goals-list::-webkit-scrollbar-track { background: rgba(var(--bg-card-light-rgb), 0.3); border-radius: 10px;} #ingresos-page .history-list::-webkit-scrollbar-thumb, #ingresos-page .monthly-goals-list::-webkit-scrollbar-thumb { background-color: var(--accent-green-medium); border-radius: 10px; border: 2px solid rgba(var(--bg-card-light-rgb), 0.3);} #ingresos-page .history-item, #ingresos-page .monthly-goal-item { display:flex; justify-content:space-between; align-items:center; padding:12px 15px; margin:5px 0; background: rgba(var(--bg-card-rgb), 0.7);Â  border-radius:10px; border-left:4px solid var(--accent-green-medium); transition: background-color 0.3s ease, transform 0.2s ease; } #ingresos-page .history-item:hover, #ingresos-page .monthly-goal-item:hover { background-color: rgba(var(--bg-card-rgb), 0.9); transform: translateX(3px); } #ingresos-page .history-date, #ingresos-page .monthly-goal-month {font-size:0.9em;color:var(--text-secondary); font-weight: 500;} #ingresos-page .history-amount, #ingresos-page .monthly-goal-status {font-weight:700;color:var(--text-primary)} #ingresos-page .history-rate { font-size: 0.8em; color: var(--accent-blue-info); margin-left: 5px;} #ingresos-page .history-original-amount {Â  font-size: 0.75em;Â  color: var(--text-secondary);Â  margin-left: 8px; } #ingresos-page .monthly-goal-status.achieved { color: var(--accent-green-neon); } #ingresos-page .monthly-goal-status.not-achieved { color: var(--accent-red-clear); } #ingresos-page .monthly-goal-status.pending { color: var(--text-secondary); } #ingresos-page .clear-btn{ background:linear-gradient(135deg, var(--accent-red-clear), #ff4040);Â  color:var(--text-primary); border:none; padding:10px 18px; border-radius:10px; font-size:0.95em; cursor:pointer; margin-top:15px; transition:all 0.3s ease; font-weight: 700; box-shadow: 0 0 10px rgba(var(--accent-red-clear-rgb), 0.3); } #ingresos-page .clear-btn:hover{ transform:translateY(-2px) scale(1.05);Â  box-shadow: 0 5px 15px rgba(var(--accent-red-clear-rgb), 0.5), 0 0 15px rgba(var(--accent-red-clear-rgb), 0.4); }

Â  Â  Â  Â 

Â  Â  Â  Â  .floating-emoji-container {

Â  Â  Â  Â  Â  Â  position: fixed;

Â  Â  Â  Â  Â  Â  top: 0;

Â  Â  Â  Â  Â  Â  left: 0;

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  Â  Â  pointer-events: none;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  Â  Â  z-index: 0;

Â  Â  Â  Â  }

Â  Â  Â  Â  .floating-emoji {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  user-select: none;

Â  Â  Â  Â  Â  Â  animation-name: floatUp;

Â  Â  Â  Â  Â  Â  animation-timing-function: linear;

Â  Â  Â  Â  Â  Â  animation-iteration-count: infinite;

Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  Â  Â  text-shadow: 0 0 8px rgba(0,0,0,0.3);

Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes floatUp {

Â  Â  Â  Â  Â  Â  from {

Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(105vh);

Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  10%, 90% {

Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0.5;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  to {

Â  Â  Â  Â  Â  Â  Â  Â  transform: translateY(-10vh);

Â  Â  Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  .floating-emoji:nth-child(1) { left: 5%; animation-delay: 0s; animation-duration: 20s; font-size: 5.5rem; color: var(--accent-yellow-pale);}Â 

Â  Â  Â  Â  .floating-emoji:nth-child(2) { left: 15%; animation-delay: 2s; animation-duration: 24s; font-size: 4rem; color: var(--accent-green-medium);}Â 

Â  Â  Â  Â  .floating-emoji:nth-child(3) { left: 28%; animation-delay: 4s; animation-duration: 18s; font-size: 6rem; color: var(--accent-blue-info);}Â 

Â  Â  Â  Â  .floating-emoji:nth-child(4) { left: 40%; animation-delay: 6s; animation-duration: 22s; font-size: 3.8rem; color: var(--accent-red-clear);}Â 

Â  Â  Â  Â  .floating-emoji:nth-child(5) { left: 55%; animation-delay: 1s; animation-duration: 27s; font-size: 5.2rem; color: var(--accent-green-neon);}Â 

Â  Â  Â  Â  .floating-emoji:nth-child(6) { left: 68%; animation-delay: 3s; animation-duration: 16s; font-size: 4.5rem; color: var(--accent-yellow-green);}

Â  Â  Â  Â  .floating-emoji:nth-child(7) { left: 80%; animation-delay: 5s; animation-duration: 21s; font-size: 5rem; color: var(--accent-pink);}

Â  Â  Â  Â  .floating-emoji:nth-child(8) { left: 92%; animation-delay: 7s; animation-duration: 19s; font-size: 4.2rem; color: var(--accent-purple);}

Â  Â  Â  Â  .floating-emoji:nth-child(9) { left: 20%; animation-delay: 8s; animation-duration: 25s; font-size: 5.8rem; color: var(--accent-orange);}

Â  Â  Â  Â  .floating-emoji:nth-child(10) { left: 75%; animation-delay: 9s; animation-duration: 17s; font-size: 4.0rem; color: var(--accent-gold);}



Â  Â  Â  Â  #timetableGrid { display: grid; grid-template-columns: [times] 60px repeat(5, 1fr); grid-auto-rows: minmax(40px, auto); gap: 3px; padding: 15px; border-radius: 12px; margin-top: 20px; max-width: 100%; overflow-x: auto; }

Â  Â  Â  Â  .timetable-grid-header, .timetable-grid-time-label, .timetable-grid-corner { background-color: rgba(var(--bg-card-rgb), 0.95); color: var(--accent-blue-info); font-weight: 600; padding: 10px 5px; text-align: center; position: sticky; z-index: 2; }

Â  Â  Â  Â  .timetable-grid-header { top: 0; }

Â  Â  Â  Â  .timetable-grid-time-label { left: 0; color: var(--accent-yellow-green); text-align: right; padding-right: 12px; font-size: 0.85em;}

Â  Â  Â  Â  .timetable-grid-corner { top: 0; left: 0; z-index: 3; }

Â  Â  Â  Â  .timetable-grid-event { color: var(--subject-default-text-color); padding: 8px; border-radius: 8px; font-weight: 500; cursor: pointer; transition: background-color 0.3s ease, transform 0.15s ease-out, box-shadow 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.25); overflow: hidden; display: flex; flex-direction: column; justify-content: flex-start; align-items: stretch; font-size: 0.8em; line-height: 1.3; min-height: 38px; position: relative; z-index: 1; }

Â  Â  Â  Â  .timetable-grid-event:hover { transform: scale(1.02); box-shadow: 0 4px 12px rgba(var(--glow-color-neutral-rgb), 0.4); z-index: 4; }

Â  Â  Â  Â  .timetable-grid-event .subject-name { font-weight: 700; display: block; margin-bottom: 3px; font-size: 1.05em; word-break: break-word; }

Â  Â  Â  Â  .timetable-grid-event .teacher-name { font-size: 0.9em; color: rgba(var(--subject-default-text-color), 0.8); display: block; word-break: break-word; }

Â  Â  Â  Â 

Â  Â  Â  Â  #calendar-progress-bars { margin-bottom: 20px; text-align: left; padding: 0 10px; }

Â  Â  Â  Â  #calendar-progress-bars .progress-item {Â 

Â  Â  Â  Â  Â  Â  display: flex; align-items: center; margin-bottom: 10px; font-size: 0.9em; color: var(--text-secondary);Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  #calendar-progress-bars .progress-label { min-width: 40px; margin-right: 10px; }

Â  Â  Â  Â  #calendar-progress-bars .progress-bar-bg-cal {

Â  Â  Â  Â  Â  Â  flex-grow: 1; max-width: 200px;Â 

Â  Â  Â  Â  Â  Â  height: 18px; background: var(--bg-card); border-radius: 18px;

Â  Â  Â  Â  Â  Â  overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.25); margin-right: 10px;

Â  Â  Â  Â  }

Â  Â  Â  Â  #calendar-progress-bars .progress-bar-cal {

Â  Â  Â  Â  Â  Â  height: 100%;Â 

Â  Â  Â  Â  Â  Â  border-radius: 18px;Â 

Â  Â  Â  Â  Â  Â  width: 0%;Â 

Â  Â  Â  Â  Â  Â  transition: width 1s ease-out, background 1s ease-out, box-shadow 1s ease-out;Â 

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  }

Â  Â  Â  Â  Â #calendar-progress-bars .progress-bar-cal::before{Â 

Â  Â  Â  Â  Â  Â  content:'';Â 

Â  Â  Â  Â  Â  Â  position:absolute;Â 

Â  Â  Â  Â  Â  Â  top:0;left:0;Â 

Â  Â  Â  Â  Â  Â  height:100%;Â 

Â  Â  Â  Â  Â  Â  width:100%;Â 

Â  Â  Â  Â  Â  Â  background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.05) 40%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.05) 60%, transparent 100%);

Â  Â  Â  Â  Â  Â  background-size: 800px 100%;

Â  Â  Â  Â  Â  Â  background-repeat: no-repeat;

Â  Â  Â  Â  Â  Â  animation: shimmer 3.5s infinite linear;

Â  Â  Â  Â  Â  Â  border-radius:18px;Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  #calendar-progress-bars .progress-text-cal { font-weight: 500; color: var(--text-primary); min-width: 45px; text-align: right;}

Â  Â  Â  Â 

Â  Â  Â  Â  #mainCalendar { max-width: 100%; margin: 0 auto; }

Â  Â  Â  Â  .fc .fc-toolbar-title { font-size: 1.5em !important; color: var(--accent-yellow-pale); }Â 

Â  Â  Â  Â  .fc .fc-button { background-color: var(--bg-card-light); border-color: rgba(var(--text-primary),0.1); color: var(--text-primary); box-shadow: none;}

Â  Â  Â  Â  .fc .fc-button:hover { background-color: var(--accent-blue-info); color:var(--bg-dark); }

Â  Â  Â  Â  .fc .fc-button-primary:disabled { background-color: var(--bg-card); color: var(--text-secondary); }

Â  Â  Â  Â  .fc th { border-color: var(--fc-border-color) !important; color: var(--accent-yellow-green); }

Â  Â  Â  Â  .fc .fc-daygrid-day-number { color: var(--text-secondary); }

Â  Â  Â  Â  .fc .fc-day-today {Â 

Â  Â  Â  Â  Â  Â  box-shadow: 0 0 18px 8px rgba(var(--accent-yellow-pale-rgb), 0.5);

Â  Â  Â  Â  Â  Â  border-radius: 12px;

Â  Â  Â  Â  Â  Â  position: relative;Â 

Â  Â  Â  Â  Â  Â  z-index: 1;

Â  Â  Â  Â  }

Â  Â  Â  Â  .fc .fc-day-today .fc-daygrid-day-frame { overflow: visible !important; }

Â  Â  Â  Â  .fc .fc-day-today .fc-daygrid-day-number { font-weight: bold; color: var(--accent-yellow-pale); }

Â  Â  Â  Â  .fc-event { white-space: normal !important; font-size: 0.85em; padding: 2px 4px; }

Â  Â  Â  Â  .fc-event .fc-event-main { overflow: hidden; text-overflow: ellipsis; }

Â  Â  Â  Â 

Â  Â  Â  Â  Â #addCalendarEventBtn {

Â  Â  Â  Â  Â  Â  font-family: 'Rubik', sans-serif;

Â  Â  Â  Â  Â  Â  font-weight: 700;

Â  Â  Â  Â  Â  Â  font-size: 1.2em;

Â  Â  Â  Â  Â  Â  margin: 20px auto;Â 

Â  Â  Â  Â  Â  Â  padding: 15px 30px;Â 

Â  Â  Â  Â  Â  Â  background: linear-gradient(45deg, var(--accent-green-medium), var(--accent-green-neon));Â 

Â  Â  Â  Â  Â  Â  color: var(--bg-dark);Â 

Â  Â  Â  Â  Â  Â  border:none;Â 

Â  Â  Â  Â  Â  Â  border-radius: 12px;Â 

Â  Â  Â  Â  Â  Â  cursor:pointer;

Â  Â  Â  Â  Â  Â  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);

Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(var(--accent-green-neon-rgb), 0.2);

Â  Â  Â  Â  }

Â  Â  Â  Â  #addCalendarEventBtn:hover {Â 

Â  Â  Â  Â  Â  Â  transform: translateY(-3px) scale(1.05);

Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 25px rgba(var(--accent-green-neon-rgb), 0.4);

Â  Â  Â  Â  }

Â  Â  Â  Â  #addCalendarEventBtn:active {

Â  Â  Â  Â  Â  Â  transform: translateY(-1px) scale(1.02);

Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(var(--accent-green-neon-rgb), 0.3);

Â  Â  Â  Â  }



Â  Â  Â  Â  .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(var(--bg-dark-rgb), 0.75); backdrop-filter: blur(10px) saturate(150%); -webkit-backdrop-filter: blur(10px) saturate(150%); display: none; justify-content: center; align-items: center; z-index: 2000; animation: modalFadeIn 0.3s ease-out; }

Â  Â  Â  Â  .modal-overlay.active { display: flex; }

Â  Â  Â  Â  @keyframes modalFadeIn { from {opacity: 0;} to {opacity: 1;} }

Â  Â  Â  Â  .modal-content { background-color: rgba(var(--bg-card-rgb), 0.95); backdrop-filter: blur(15px) saturate(180%); padding: 25px 30px; border-radius: 20px; box-shadow: 0 0 30px rgba(var(--glow-color-blue-rgb),0.25), 0 10px 40px rgba(0,0,0,0.35); width: 90%; max-width: 500px; border: 1px solid rgba(var(--text-primary),0.15); animation: popInModal 0.3s ease-out; z-index: 2010; }

Â  Â  Â  Â  @keyframes popInModal { from { opacity:0; transform: scale(0.9) translateY(10px); } to { opacity:1; transform: scale(1) translateY(0); } }

Â  Â  Â  Â  .modal-content h3 { color: var(--accent-blue-info); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.5em; text-shadow: 0 0 5px rgba(var(--glow-color-blue-rgb), 0.3); }

Â  Â  Â  Â  .modal-form-group { margin-bottom: 18px; }

Â  Â  Â  Â  .modal-form-group label { display: block; color: var(--text-secondary); margin-bottom: 6px; font-size: 0.9em; text-align: left; }

Â  Â  Â  Â  .modal-form-group input[type="text"], .modal-form-group input[type="date"], .modal-form-group input[type="time"], .modal-form-group select { width: 100%; padding: 10px 12px; border: 1px solid #4a505e; border-radius: 8px; background-color: var(--bg-dark); color: var(--text-primary); font-size: 1em; font-family: 'Rubik', sans-serif; }

Â  Â  Â  Â  .modal-form-group input[type="checkbox"]{ width: auto; vertical-align: middle; margin-left: 5px;}

Â  Â  Â  Â  .modal-form-group input[type="text"]:focus, .modal-form-group input[type="date"]:focus, .modal-form-group input[type="time"]:focus, .modal-form-group select:focus { outline: none; border-color: var(--accent-blue-info); box-shadow: 0 0 8px rgba(var(--glow-color-blue-rgb), 0.3); }

Â  Â  Â  Â  .modal-actions { margin-top: 25px; display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap; }Â 

Â  Â  Â  Â  .modal-actions button { flex-grow: 1; min-width: 100px; padding: 10px 15px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 0.95em; }

Â  Â  Â  Â  #saveEventBtn { background-color: var(--accent-green-medium); color: var(--bg-dark); } #saveEventBtn:hover { background-color: var(--accent-green-neon); }

Â  Â  Â  Â  #cancelEventBtn { background-color: var(--bg-card-light); color: var(--text-primary); } #cancelEventBtn:hover { background-color: #3e4450; }

Â  Â  Â  Â  #deleteEventBtn { background-color: var(--accent-red-clear); color: var(--text-primary); display: none; } #deleteEventBtn:hover { background-color: #d43f3f; }

Â  Â  Â  Â  .hidden-field { display: none !important; }



Â  Â  Â  Â  @media (min-width: 1024px) { }

Â  Â  Â  Â  @media (max-width:768px){Â Â 

Â  Â  Â  Â  Â  Â  .main-navigation { padding: 10px; gap: 8px; top:10px; }Â 

Â  Â  Â  Â  Â  Â  .nav-button { padding: 8px 12px; font-size: 0.85em;}Â 

Â  Â  Â  Â  Â  Â  .widget-card { padding:20px; margin: 0 auto 20px auto; flex-basis: 100% !important; max-width: calc(100% - 20px) !important;}Â 

Â  Â  Â  Â  Â  Â  #ingresos-page .money-display{grid-template-columns:1fr}Â Â 

Â  Â  Â  Â  Â  Â  #ingresos-page .title, .placeholder-page h2, .university-timetable-widget h2, #calendario-page h2 {font-size:1.5em}Â 

Â  Â  Â  Â  Â  Â  #timetableGrid { font-size: 0.9em; gap: 2px; padding:10px; grid-template-columns: [times] 45px repeat(5, 1fr); grid-auto-rows: minmax(35px, auto); }

Â  Â  Â  Â  Â  Â  .timetable-grid-event { font-size: 0.75em; padding: 5px; }

Â  Â  Â  Â  Â  Â  .timetable-grid-time-label { font-size: 0.75em; padding-right: 5px;}

Â  Â  Â  Â  Â  Â  .timetable-grid-header { padding: 8px 3px; }

Â  Â  Â  Â  Â  Â  .fc .fc-toolbar { flex-direction: column; gap: 5px;}

Â  Â  Â  Â  Â  Â  #calendar-progress-bars .progress-bar-bg-cal { max-width: 100%; }Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  @media (max-width:480px){Â 

Â  Â  Â  Â  Â  Â  body { padding: 10px; }Â 

Â  Â  Â  Â  Â  Â  .floating-emoji { font-size: 3.5rem; opacity: 0.1; }Â Â 

Â  Â  Â  Â  Â  Â  .widget-card, .modal-content { backdrop-filter: blur(8px) saturate(120%); -webkit-backdrop-filter: blur(8px) saturate(120%); }Â 

Â  Â  Â  Â  Â  Â  #timetableGrid { font-size: 0.8em; grid-template-columns: [times] 40px repeat(5, 1fr); grid-auto-rows: minmax(30px, auto); padding: 5px; }

Â  Â  Â  Â  Â  Â  .timetable-grid-event { font-size: 0.7em; padding: 4px; min-height: 28px;}

Â  Â  Â  Â  Â  Â  .timetable-grid-event .subject-name { margin-bottom: 1px; }

Â  Â  Â  Â  Â  Â  .timetable-grid-time-label { font-size: 0.7em; }

Â  Â  Â  Â  Â  Â  .fc .fc-toolbar-left, .fc .fc-toolbar-center, .fc .fc-toolbar-right { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-bottom: 5px; }

Â  Â  Â  Â  Â  Â  .fc .fc-button { padding: 0.3em 0.5em; font-size: 0.85em;}

Â  Â  Â  Â  Â  Â  #calendar-progress-bars div {font-size: 0.8em;}

Â  Â  Â  Â  }

Â  Â  </style>

</head>

<body>

Â  Â  <div id="loading-indicator">Cargando datos compartidos...</div>

Â  Â  <div class="floating-emoji-container">

Â  Â  Â  Â  <span class="floating-emoji">ğŸ’°</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸ“</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸ“…</span>

Â  Â  Â  Â  <span class="floating-emoji">âœ¨</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸš€</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸ†</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸ“ˆ</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸ¯</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸ’¡</span>

Â  Â  Â  Â  <span class="floating-emoji">ğŸ“š</span>

Â  Â  </div>

Â  Â 

Â  Â  <div class="main-container">

Â  Â  Â  Â  <div class="main-navigation">Â 

Â  Â  Â  Â  Â  Â  <button class="nav-button" data-page="calendario-page">ğŸ“… Calendario</button>Â 

Â  Â  Â  Â  Â  Â  <button class="nav-button" data-page="ingresos-page">ğŸ’° Ingresos</button>Â 

Â  Â  Â  Â  Â  Â  <button class="nav-button" data-page="universidad-page">ğŸ“ Universidad</button>Â 

Â  Â  Â  Â  </div>



Â  Â  Â  Â  <div id="ingresos-page" class="page-content">

Â  Â  Â  Â  Â  Â  <div class="page-widget-container">

Â  Â  Â  Â  Â  Â  Â  Â  <div id="ingresos-widget-main" class="widget-card">Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="current-month-display glass-section" id="currentMonthDisplay"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="title-container"> <h1 class="title">ğŸ¯ Meta Ingresos</h1> <div class="target-input-group"> <label for="overallTargetInput">Meta (COP):</label> <input type="number" id="overallTargetInput" step="1000" placeholder="3,500,000"> </div> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="subtitle" id="subtitleText">ğŸš€ Progreso hacia tu meta general...</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-section glass-section"> <div class="currency-selector-container"> <label for="currencySelectorIngresos">Moneda de Ingreso:</label> <select id="currencySelectorIngresos"> <option value="USD" selected>USD ($)</option> <option value="COP">COP ($)</option> </select> </div> <input type="number" class="money-input" id="moneyInputIngresos" placeholder="ğŸ’µ Ingresa cantidad en USD..." min="0.01" step="0.01"> <button class="add-btn" id="addMoneyBtnIngresos">â• AÃ±adir Ingreso</button> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-container"> <div class="progress-bar-bg"> <div class="progress-bar" id="progressBarOverall"></div> </div> <div class="progress-text" id="progressTextOverall">0% ğŸ“Š</div> </div> <div class="progress-container monthly"> <div class="progress-bar-bg"> <div class="progress-bar" id="progressBarMonthly"></div> </div> <div class="progress-text monthly-text" id="progressTextMonthly">ğŸ—“ï¸ Tiempo del Mes: 0%</div> </div> <div class="money-display"> <div class="money-card widget-card"> <div class="money-label">ğŸ’š Total Ingresos Netos Acumulados (COP)</div> <div class="money-value" id="totalAccumulatedCOP">$0</div> </div> <div class="money-card widget-card"> <div class="money-label">ğŸ Meta General Actual (COP)</div> <div class="money-value" id="overallTargetCOPDisplay">$0</div> </div> <div class="money-card widget-card"> <div class="money-label">ğŸ“ˆ Restante Meta General (COP)</div> <div class="money-value" id="overallRemainingCOP">$0</div> </div> <div class="money-card widget-card"> <div class="money-label">ğŸ’µ Ingresos Netos este Mes (USD)</div> <div class="money-value" id="currentMonthUSDTotal">$0.00</div> </div> </div> <div class="money-card widget-card" style="margin-top: 15px;"> <div class="money-label">ğŸŒ Total Ingresos Netos HistÃ³rico (USD)</div> <div class="money-value" id="overallUSDTotal">$0.00</div> <div class="exchange-rate-info" id="exchangeRateInfo" style="margin-top: 5px;">Tasa actual: Cargando...</div> <div class="exchange-rate-source" id="exchangeRateSource" style="display: none;"></div> </div> <div class="celebration-overall" id="celebrationOverall"> ğŸ‰âœ¨ Â¡FELICITACIONES! Â¡META GENERAL ALCANZADA! âœ¨ğŸ‰<br> ğŸ† Â¡Eres un maestro del joseo! Te amo. ğŸ† </div>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="history widget-card"> <div class="history-title">ğŸ“ Historial Detallado de Ingresos (Netos)</div> <div class="history-list" id="historyList"></div> </div>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="monthly-goals-section widget-card"> <div class="monthly-goals-title">ğŸ¯ Progreso Ingresos Mensuales (Netos vs Meta)</div> <div class="monthly-goals-list" id="monthlyGoalsList"></div> <button class="clear-btn" id="clearHistoryBtnIngresos">ğŸ—‘ï¸ Limpiar Todo el Historial</button> </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>



Â  Â  Â  Â  <div id="calendario-page" class="page-content active">

Â  Â  Â  Â  Â  Â  Â <div class="page-widget-container" id="calendar-widget-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="calendar-widget-card" class="widget-card">Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2>ğŸ“… Calendario Interactivo</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="calendar-progress-bars">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-item">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="progress-label">Mes:</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-bar-bg-cal"> <div class="progress-bar-cal" id="month-progress-bar-cal"></div> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="progress-text-cal" id="month-text-cal">0%</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-item">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="progress-label">DÃ­a:</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-bar-bg-cal"> <div class="progress-bar-cal" id="day-progress-bar-cal"></div> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="progress-text-cal" id="day-text-cal">0%</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-item">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="progress-label">AÃ±o:</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="progress-bar-bg-cal"> <div class="progress-bar-cal" id="year-progress-bar-cal"></div> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="progress-text-cal" id="year-text-cal">0%</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="addCalendarEventBtn">â• Nueva Actividad</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="mainCalendar"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="today-tasks" style="margin-top: 20px; text-align: left; padding:15px; background-color: rgba(var(--bg-card-rgb),0.8); border-radius: 10px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h3 style="color: var(--accent-yellow-green); margin-bottom:10px;">ğŸ“ Actividades para Hoy:</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul id="today-tasks-list" style="list-style: none; padding-left: 5px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li style="color: var(--text-secondary);">Cargando actividades...</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  </div>

Â  Â  Â  Â 

Â  Â  Â  Â  <div id="universidad-page" class="page-content">Â 

Â  Â  Â  Â  Â  Â  Â <div class="page-widget-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="university-timetable-widget widget-card">Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h2>ğŸ“ Horario Universitario</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="timetableGrid"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="addTimetableEventBtnGlobal" style="margin-top: 20px; padding: 10px 20px; background-color: var(--accent-blue-info); color: var(--bg-dark); border:none; border-radius: 8px; cursor:pointer; font-weight: 600;">â• AÃ±adir Nuevo Evento</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  </div>

Â  Â  </div>Â 



Â  Â  <div class="modal-overlay" id="eventModalOverlay">

Â  Â  Â  Â  <div class="modal-content">Â 

Â  Â  Â  Â  Â  Â  <h3 id="eventModalTitle">AÃ±adir/Editar Evento</h3>

Â  Â  Â  Â  Â  Â  <form id="eventForm" novalidate>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" id="eventModalId">Â 

Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" id="eventModalType">Â 



Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-form-group"> <label for="eventTitle">TÃ­tulo/Materia:</label> <input type="text" id="eventTitle" required> </div>

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  <div id="modalTimetableFields">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-form-group"> <label for="eventTeacher">Profesor:</label> <input type="text" id="eventTeacher"> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-form-group"> <label for="eventDay">DÃ­a (Horario):</label> <select id="eventDay"></select> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-form-group timetable-common-fields"> <label for="eventStartTime">Hora Inicio (Horario):</label> <select id="eventStartTime"></select> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-form-group timetable-common-fields"> <label for="eventEndTime">Hora Fin (Horario):</label> <select id="eventEndTime"></select> </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="modalCalendarFields">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="modal-form-group"> <label for="eventStartDate">Fecha:</label> <input type="date" id="eventStartDate"> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="modal-form-group hidden-field"> <label for="eventStartTimeCal">Hora Inicio (Calendario):</label> <input type="time" id="eventStartTimeCal"> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="modal-form-group hidden-field"> <label for="eventEndDate">Fecha Fin:</label> <input type="date" id="eventEndDate"> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="modal-form-group hidden-field"> <label for="eventEndTimeCal">Hora Fin (Calendario):</label> <input type="time" id="eventEndTimeCal"> </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="modal-form-group hidden-field"><label for="eventAllDay">Todo el dÃ­a:</label><input type="checkbox" id="eventAllDay" checked></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-form-group">Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="eventColorSelect">Color del Evento:</label>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="eventColorSelect" required></select>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-actions">Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="deleteEventBtn">Eliminar</button>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" id="cancelEventBtn">Cancelar</button>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" id="saveEventBtn">Guardar</button>Â 

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â 

Â  Â  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>

Â  Â  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore-compat.js"></script>



Â  Â  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js'></script>

Â  Â  <script src='https://cdn.jsdelivr.net/npm/ical.js@2.0.1/build/ical.min.js'></script>



Â  Â  <script>

Â  Â  Â  Â  // --- Toda la secciÃ³n de JavaScript permanece sin cambios ---

Â  Â  Â  Â  const firebaseConfig = {

Â  Â  Â  Â  Â  apiKey: "AIzaSyBCuJ4Xetzex0zQpnrOKx1bLihpfX-0KaI",

Â  Â  Â  Â  Â  authDomain: "meta-ingresos-app.firebaseapp.com",

Â  Â  Â  Â  Â  projectId: "meta-ingresos-app",

Â  Â  Â  Â  Â  storageBucket: "meta-ingresos-app.appspot.com",

Â  Â  Â  Â  Â  messagingSenderId: "367840381632",

Â  Â  Â  Â  Â  appId: "1:367840381632:web:8d124fc5ee24183445fb25",

Â  Â  Â  Â  Â  measurementId: "G-SE63KFXXRS"

Â  Â  Â  Â  };

Â  Â  Â  Â  firebase.initializeApp(firebaseConfig);

Â  Â  Â  Â  const db = firebase.firestore();

Â  Â  Â  Â  const SHARED_DATA_PATH = db.collection('organizador-publico').doc('datos-compartidos');

Â  Â  Â  Â  const DEFAULT_OVERALL_TARGET_COP = 3500000;Â 

Â  Â  Â  Â  const EXCHANGE_RATE_API_URL_ERAPI = 'https://open.er-api.com/v6/latest/USD';Â 

Â  Â  Â  Â  const FALLBACK_RATE = 4000;Â 

Â  Â  Â  Â  const FIXED_FEE_USD = 3;Â 

Â  Â  Â  Â  const PERCENTAGE_FEE = 0.03;Â 

Â  Â  Â  Â  const MIN_USD_INPUT_FOR_NET_CALC = FIXED_FEE_USD + 0.01;Â 

Â  Â  Â  Â  const TIMETABLE_START_HOUR = 5;Â 

Â  Â  Â  Â  const TIMETABLE_END_HOUR = 23;Â Â 

Â  Â  Â  Â  const TIMETABLE_DAYS = ["LUNES", "MARTES", "MIÃ‰RCOLES", "JUEVES", "VIERNES"];

Â  Â  Â  Â  const PRESET_PASTEL_COLORS = [

Â  Â  Â  Â  Â  Â  { name: "Rosa Suave", value: "#FFB6C1" }, { name: "MelocotÃ³n", value: "#FFDAB9" },

Â  Â  Â  Â  Â  Â  { name: "Amarillo Claro", value: "#FFFFE0" }, { name: "Menta", value: "#98FB98" },

Â  Â  Â  Â  Â  Â  { name: "Cielo", value: "#ADD8E6" }, { name: "Lavanda", value: "#E6E6FA" },

Â  Â  Â  Â  Â  Â  { name: "Gris Perla", value: "#D3D3D3" }, { name: "Beige Arenoso", value: "#F5F5DC" },

Â  Â  Â  Â  Â  Â  { name: "Verde Mar", value: "#AFEEEE" },Â  Â 

Â  Â  Â  Â  Â  Â  { name: "SalmÃ³n Claro", value: "#FFA07A" }

Â  Â  Â  Â  ];

Â  Â  Â  Â  const DEFAULT_EVENT_COLOR = PRESET_PASTEL_COLORS[0].value;Â 

Â  Â  Â  Â  let appState = {

Â  Â  Â  Â  Â  Â  contributions: [],

Â  Â  Â  Â  Â  Â  monthlyTargets: {},

Â  Â  Â  Â  Â  Â  selectedInputCurrencyIngresos: 'USD',

Â  Â  Â  Â  Â  Â  timetableData: [],

Â  Â  Â  Â  Â  Â  calendarEventsData: [],

Â  Â  Â  Â  };

Â  Â  Â  Â  let mainCalendarInstance = null;Â 

Â  Â  Â  Â  let currentDailyExchangeRate = null;Â 

Â  Â  Â  Â  let currentEditingEventId = null;Â 

Â  Â  Â  Â  let currentEditingEventType = '';Â 

Â  Â  Â  Â  let defaultPage = 'calendario-page';Â 

Â  Â  Â  Â  const elIngresos = {Â Â 

Â  Â  Â  Â  Â  Â  currentMonthDisplay: document.getElementById('currentMonthDisplay'),Â 

Â  Â  Â  Â  Â  Â  moneyInput: document.getElementById('moneyInputIngresos'),Â Â 

Â  Â  Â  Â  Â  Â  addMoneyButton: document.getElementById('addMoneyBtnIngresos'),Â Â 

Â  Â  Â  Â  Â  Â  clearHistoryButton: document.getElementById('clearHistoryBtnIngresos'),Â 

Â  Â  Â  Â  Â  Â  overallTargetInput: document.getElementById('overallTargetInput'),Â 

Â  Â  Â  Â  Â  Â  subtitle: document.getElementById('subtitleText'),Â 

Â  Â  Â  Â  Â  Â  progressBarOverall: document.getElementById('progressBarOverall'),Â 

Â  Â  Â  Â  Â  Â  progressTextOverall: document.getElementById('progressTextOverall'),Â 

Â  Â  Â  Â  Â  Â  progressBarMonthly: document.getElementById('progressBarMonthly'),Â 

Â  Â  Â  Â  Â  Â  progressTextMonthly: document.getElementById('progressTextMonthly'),Â 

Â  Â  Â  Â  Â  Â  totalAccumulatedCOP: document.getElementById('totalAccumulatedCOP'),Â Â 

Â  Â  Â  Â  Â  Â  overallTargetCOPDisplay: document.getElementById('overallTargetCOPDisplay'),Â Â 

Â  Â  Â  Â  Â  Â  overallRemainingCOP: document.getElementById('overallRemainingCOP'),Â Â 

Â  Â  Â  Â  Â  Â  currentMonthUSDTotal: document.getElementById('currentMonthUSDTotal'),Â 

Â  Â  Â  Â  Â  Â  overallUSDTotal: document.getElementById('overallUSDTotal'),Â Â 

Â  Â  Â  Â  Â  Â  exchangeRateInfo: document.getElementById('exchangeRateInfo'),Â 

Â  Â  Â  Â  Â  Â  exchangeRateSource: document.getElementById('exchangeRateSource'),Â 

Â  Â  Â  Â  Â  Â  celebrationOverall: document.getElementById('celebrationOverall'),Â Â 

Â  Â  Â  Â  Â  Â  historyList: document.getElementById('historyList'),Â 

Â  Â  Â  Â  Â  Â  monthlyGoalsList: document.getElementById('monthlyGoalsList'),Â 

Â  Â  Â  Â  Â  Â  currencySelector: document.getElementById('currencySelectorIngresos')

Â  Â  Â  Â  };

Â  Â  Â  Â  const addTimetableEventBtnGlobal = document.getElementById('addTimetableEventBtnGlobal');Â 

Â  Â  Â  Â  const addCalendarEventBtn = document.getElementById('addCalendarEventBtn');

Â  Â  Â  Â  const eventModalOverlay = document.getElementById('eventModalOverlay');

Â  Â  Â  Â  const eventForm = document.getElementById('eventForm');

Â  Â  Â  Â  const eventModalTitle = document.getElementById('eventModalTitle');

Â  Â  Â  Â  const modalEventIdInput = document.getElementById('eventModalId');Â 

Â  Â  Â  Â  const modalEventTypeInput = document.getElementById('eventModalType');

Â  Â  Â  Â  const modalEventTitleInput = document.getElementById('eventTitle');Â 

Â  Â  Â  Â  const modalTimetableFields = document.getElementById('modalTimetableFields');

Â  Â  Â  Â  const modalEventTeacherInput = document.getElementById('eventTeacher');

Â  Â  Â  Â  const modalEventDaySelect = document.getElementById('eventDay');

Â  Â  Â  Â  const modalCalendarFields = document.getElementById('modalCalendarFields');

Â  Â  Â  Â  const modalEventStartDateInput = document.getElementById('eventStartDate');

Â  Â  Â  Â  const modalEventStartTimeCalInput = document.getElementById('eventStartTimeCal');

Â  Â  Â  Â  const modalEventEndDateInput = document.getElementById('eventEndDate');

Â  Â  Â  Â  const modalEventEndTimeCalInput = document.getElementById('eventEndTimeCal');

Â  Â  Â  Â  const modalEventAllDayCheckbox = document.getElementById('eventAllDay');

Â  Â  Â  Â  const modalEventStartTimeSelect = document.getElementById('eventStartTime');Â 

Â  Â  Â  Â  const modalEventEndTimeSelect = document.getElementById('eventEndTime');Â  Â 

Â  Â  Â  Â  const modalEventColorSelect = document.getElementById('eventColorSelect');

Â  Â  Â  Â  const saveEventBtn = document.getElementById('saveEventBtn');

Â  Â  Â  Â  const cancelEventBtn = document.getElementById('cancelEventBtn');

Â  Â  Â  Â  const deleteEventBtn = document.getElementById('deleteEventBtn');

Â  Â  Â  Â  function loadSharedDataFromFirestore() {

Â  Â  Â  Â  Â  Â  const loadingIndicator = document.getElementById('loading-indicator');

Â  Â  Â  Â  Â  Â  loadingIndicator.style.display = 'flex';

Â  Â  Â  Â  Â  Â  SHARED_DATA_PATH.onSnapshot(async (doc) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (doc.exists) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = doc.data();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appState = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contributions: data.contributions || [],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthlyTargets: data.monthlyTargets || {},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedInputCurrencyIngresos: data.selectedInputCurrencyIngresos || 'USD',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timetableData: data.timetableData || [],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendarEventsData: data.calendarEventsData || [],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Datos compartidos cargados desde Firestore.");

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("No existen datos compartidos, creando documento inicial.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await saveSharedDataToFirestore();Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  updateAllUI();

Â  Â  Â  Â  Â  Â  Â  Â  loadingIndicator.style.opacity = '0';

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { loadingIndicator.style.display = 'none'; }, 500);

Â  Â  Â  Â  Â  Â  }, error => {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error al cargar datos desde Firestore:", error);

Â  Â  Â  Â  Â  Â  Â  Â  loadingIndicator.textContent = 'Error al cargar datos.';

Â  Â  Â  Â  Â  Â  Â  Â  alert("No se pudieron cargar los datos compartidos. Revisa la conexiÃ³n o las reglas de Firestore.");

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â  async function saveSharedDataToFirestore() {

Â  Â  Â  Â  Â  Â  const dataToSave = {

Â  Â  Â  Â  Â  Â  Â  Â  ...appState,

Â  Â  Â  Â  Â  Â  Â  Â  lastUpdated: firebase.firestore.FieldValue.serverTimestamp()

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  await SHARED_DATA_PATH.set(dataToSave, { merge: true });

Â  Â  Â  Â  Â  Â  Â  Â  console.log("Datos compartidos guardados en Firestore.");

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error al guardar datos en Firestore:", error);

Â  Â  Â  Â  Â  Â  Â  Â  alert("Error: No se pudieron guardar tus cambios.");

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  function updateAllUI() {

Â  Â  Â  Â  Â  Â  updateAllDisplays_Ingresos();

Â  Â  Â  Â  Â  Â  renderTimetable();

Â  Â  Â  Â  Â  Â  updateCalendarProgressBars();Â 

Â  Â  Â  Â  Â  Â  updateMonthlyTimeProgress();

Â  Â  Â  Â  Â  Â  if (mainCalendarInstance) {

Â  Â  Â  Â  Â  Â  Â  Â  mainCalendarInstance.refetchEvents();

Â  Â  Â  Â  Â  Â  Â  Â  updateTodayTasksList();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  function showPage(pageId) {Â 

Â  Â  Â  Â  Â  Â  document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));

Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));

Â  Â  Â  Â  Â  Â  const page = document.getElementById(pageId);

Â  Â  Â  Â  Â  Â  const button = document.querySelector(`.nav-button[data-page="${pageId}"]`);

Â  Â  Â  Â  Â  Â  if(page) page.classList.add('active');

Â  Â  Â  Â  Â  Â  if(button) button.classList.add('active');

Â  Â  Â  Â  Â  Â  if (pageId === 'calendario-page' && mainCalendarInstance) {

Â  Â  Â  Â  Â  Â  Â  Â  mainCalendarInstance.updateSize();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  function formatUSD(amount) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount); }

Â  Â  Â  Â  function formatCOP(amount) { return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 }).format(amount); }

Â  Â  Â  Â  function updateCalendarProgressBars() {

Â  Â  Â  Â  Â  Â  const now = new Date();

Â  Â  Â  Â  Â  Â  const startOfYear = new Date(now.getFullYear(), 0, 1);

Â  Â  Â  Â  Â  Â  const dayOfYear = Math.floor((now - startOfYear) / (1000 * 60 * 60 * 24)) + 1;

Â  Â  Â  Â  Â  Â  const daysInYear = (now.getFullYear() % 4 === 0 && now.getFullYear() % 100 !== 0) || now.getFullYear() % 400 === 0 ? 366 : 365;

Â  Â  Â  Â  Â  Â  const yearProgress = (dayOfYear / daysInYear) * 100;

Â  Â  Â  Â  Â  Â  const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);

Â  Â  Â  Â  Â  Â  const dayOfMonth = now.getDate();

Â  Â  Â  Â  Â  Â  const daysInMonth = endOfMonth.getDate();

Â  Â  Â  Â  Â  Â  const monthProgress = (dayOfMonth / daysInMonth) * 100;

Â  Â  Â  Â  Â  Â  const dayProgress = ((now.getHours() * 60 + now.getMinutes()) / (24 * 60)) * 100;

Â  Â  Â  Â  Â  Â  const yearBar = document.getElementById('year-progress-bar-cal');

Â  Â  Â  Â  Â  Â  const monthBar = document.getElementById('month-progress-bar-cal');

Â  Â  Â  Â  Â  Â  const dayBar = document.getElementById('day-progress-bar-cal');

Â  Â  Â  Â  Â  Â  const yearText = document.getElementById('year-text-cal');

Â  Â  Â  Â  Â  Â  const monthText = document.getElementById('month-text-cal');

Â  Â  Â  Â  Â  Â  const dayText = document.getElementById('day-text-cal');

Â  Â  Â  Â  Â  Â  if(!yearBar || !monthBar || !dayBar) return;

Â  Â  Â  Â  Â  Â  const setProgress = (bar, textEl, progress) => {

Â  Â  Â  Â  Â  Â  Â  Â  bar.style.width = `${progress}%`;

Â  Â  Â  Â  Â  Â  Â  Â  textEl.textContent = `${Math.floor(progress)}%`;

Â  Â  Â  Â  Â  Â  Â  Â  let gradient, glowRgb;

Â  Â  Â  Â  Â  Â  Â  Â  if (progress < 25) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gradient = `linear-gradient(90deg, var(--red-dark), var(--accent-red-clear))`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  glowRgb = `var(--accent-red-clear-rgb)`;

Â  Â  Â  Â  Â  Â  Â  Â  } else if (progress < 50) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gradient = `linear-gradient(90deg, var(--orange-dark), var(--accent-orange))`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  glowRgb = `var(--accent-orange-rgb)`;

Â  Â  Â  Â  Â  Â  Â  Â  } else if (progress < 75) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gradient = `linear-gradient(90deg, var(--accent-yellow-green), var(--accent-yellow-pale))`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  glowRgb = `var(--accent-yellow-green-rgb)`;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gradient = `linear-gradient(90deg, var(--green-dark), var(--accent-green-medium))`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  glowRgb = `var(--glow-color-green-rgb)`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  bar.style.background = gradient;

Â  Â  Â  Â  Â  Â  Â  Â  bar.style.boxShadow = `0 0 10px 2px rgba(${glowRgb}, 0.5)`;

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  setProgress(yearBar, yearText, yearProgress);

Â  Â  Â  Â  Â  Â  setProgress(monthBar, monthText, monthProgress);

Â  Â  Â  Â  Â  Â  setProgress(dayBar, dayText, dayProgress);

Â  Â  Â  Â  }

Â  Â  Â  Â  function updateMonthlyTimeProgress() {

Â  Â  Â  Â  Â  Â  const now = new Date();

Â  Â  Â  Â  Â  Â  const dayOfMonth = now.getDate();

Â  Â  Â  Â  Â  Â  const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();

Â  Â  Â  Â  Â  Â  const progress = (dayOfMonth / daysInMonth) * 100;

Â  Â  Â  Â  Â  Â  if (elIngresos.progressBarMonthly && elIngresos.progressTextMonthly) {

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.progressBarMonthly.style.width = `${progress}%`;

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.progressTextMonthly.textContent = `ğŸ—“ï¸ Tiempo del Mes: ${progress.toFixed(0)}%`;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  async function getDailyExchangeRate_Ingresos() {

Â  Â  Â  Â  Â  Â  elIngresos.exchangeRateInfo.textContent = "Tasa actual: Actualizando...";

Â  Â  Â  Â  Â  Â  elIngresos.addMoneyButton.disabled = true;

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(EXCHANGE_RATE_API_URL_ERAPI);

Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('Network response was not ok');

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  currentDailyExchangeRate = data.rates.COP;

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.exchangeRateInfo.textContent = `1 USD = ${formatCOP(currentDailyExchangeRate)}`;

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed to fetch exchange rate:", error);

Â  Â  Â  Â  Â  Â  Â  Â  currentDailyExchangeRate = FALLBACK_RATE;

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.exchangeRateInfo.textContent = `1 USD â‰ˆ ${formatCOP(FALLBACK_RATE)} (Respaldo)`;

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.addMoneyButton.disabled = false;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  async function addMoney_Ingresos() {

Â  Â  Â  Â  Â  Â  if (!currentDailyExchangeRate) {

Â  Â  Â  Â  Â  Â  Â  Â  alert("Tasa de cambio no disponible, por favor espera.");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const rawAmount = parseFloat(elIngresos.moneyInput.value);

Â  Â  Â  Â  Â  Â  if (isNaN(rawAmount) || rawAmount <= 0) {

Â  Â  Â  Â  Â  Â  Â  Â  alert(`âš ï¸ Ingrese un monto vÃ¡lido.`);

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let netAmountUSD = 0;

Â  Â  Â  Â  Â  Â  let netAmountCOP = 0;

Â  Â  Â  Â  Â  Â  let originalGrossAmountUSD = 0;

Â  Â  Â  Â  Â  Â  if (appState.selectedInputCurrencyIngresos === 'USD') {

Â  Â  Â  Â  Â  Â  Â  Â  originalGrossAmountUSD = rawAmount;

Â  Â  Â  Â  Â  Â  Â  Â  if (originalGrossAmountUSD < MIN_USD_INPUT_FOR_NET_CALC) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`âš ï¸ El monto bruto debe ser mayor para cubrir comisiones.`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const amountAfterFixedFee = originalGrossAmountUSD - FIXED_FEE_USD;

Â  Â  Â  Â  Â  Â  Â  Â  netAmountUSD = amountAfterFixedFee * (1 - PERCENTAGE_FEE);

Â  Â  Â  Â  Â  Â  Â  Â  netAmountCOP = netAmountUSD * currentDailyExchangeRate;

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  netAmountCOP = rawAmount;

Â  Â  Â  Â  Â  Â  Â  Â  netAmountUSD = netAmountCOP / currentDailyExchangeRate;

Â  Â  Â  Â  Â  Â  Â  Â  originalGrossAmountUSD = netAmountUSD;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const now = new Date();

Â  Â  Â  Â  Â  Â  appState.contributions.push({Â 

Â  Â  Â  Â  Â  Â  Â  Â  amountUSD: netAmountUSD,Â 

Â  Â  Â  Â  Â  Â  Â  Â  amountCOP: netAmountCOP,Â 

Â  Â  Â  Â  Â  Â  Â  Â  originalAmountUSD: originalGrossAmountUSD,Â 

Â  Â  Â  Â  Â  Â  Â  Â  exchangeRate: currentDailyExchangeRate,Â 

Â  Â  Â  Â  Â  Â  Â  Â  date: now.toISOString(),

Â  Â  Â  Â  Â  Â  Â  Â  monthYear: `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  elIngresos.moneyInput.value = '';

Â  Â  Â  Â  Â  Â  await saveSharedDataToFirestore();

Â  Â  Â  Â  }

Â  Â  Â  Â  function updateAllDisplays_Ingresos() {

Â  Â  Â  Â  Â  Â  if (!elIngresos.subtitle) return;

Â  Â  Â  Â  Â  Â  const totalCOPSavedOverall = appState.contributions.reduce((s, c) => s + c.amountCOP, 0);

Â  Â  Â  Â  Â  Â  const totalUSDSavedOverall = appState.contributions.reduce((s, c) => s + c.amountUSD, 0);

Â  Â  Â  Â  Â  Â  const currentMonthKey = `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}`;

Â  Â  Â  Â  Â  Â  const totalUSDSavedThisMonth = appState.contributions

Â  Â  Â  Â  Â  Â  Â  Â  .filter(c => c.monthYear === currentMonthKey)

Â  Â  Â  Â  Â  Â  Â  Â  .reduce((s, c) => s + c.amountUSD, 0);

Â  Â  Â  Â  Â  Â  const currentOverallTargetCOP = appState.monthlyTargets[currentMonthKey] || DEFAULT_OVERALL_TARGET_COP;

Â  Â  Â  Â  Â  Â  elIngresos.overallTargetInput.value = currentOverallTargetCOP;

Â  Â  Â  Â  Â  Â  const percentageOverall = currentOverallTargetCOP > 0 ? Math.min((totalCOPSavedOverall / currentOverallTargetCOP) * 100, 100) : 0;

Â  Â  Â  Â  Â  Â  const remainingOverallCOP = Math.max(currentOverallTargetCOP - totalCOPSavedOverall, 0);

Â  Â  Â  Â  Â  Â  elIngresos.subtitle.textContent = `ğŸš€ Progreso hacia tu meta de ${formatCOP(currentOverallTargetCOP)}`;

Â  Â  Â  Â  Â  Â  elIngresos.progressBarOverall.style.width = percentageOverall + '%';

Â  Â  Â  Â  Â  Â  elIngresos.progressTextOverall.textContent = percentageOverall.toFixed(1) + '% ğŸ“Š';

Â  Â  Â  Â  Â  Â  elIngresos.totalAccumulatedCOP.textContent = formatCOP(totalCOPSavedOverall);

Â  Â  Â  Â  Â  Â  elIngresos.overallTargetCOPDisplay.textContent = formatCOP(currentOverallTargetCOP);

Â  Â  Â  Â  Â  Â  elIngresos.overallRemainingCOP.textContent = formatCOP(remainingOverallCOP);

Â  Â  Â  Â  Â  Â  elIngresos.currentMonthUSDTotal.textContent = formatUSD(totalUSDSavedThisMonth);

Â  Â  Â  Â  Â  Â  elIngresos.overallUSDTotal.textContent = formatUSD(totalUSDSavedOverall);

Â  Â  Â  Â  Â  Â  elIngresos.celebrationOverall.style.display = (totalCOPSavedOverall >= currentOverallTargetCOP && currentOverallTargetCOP > 0) ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  updateHistory_Ingresos();

Â  Â  Â  Â  Â  Â  updateMonthlyGoalsDisplay_Ingresos();

Â  Â  Â  Â  }

Â  Â  Â  Â  function updateHistory_Ingresos() {

Â  Â  Â  Â  Â  Â  if (!elIngresos.historyList) return;

Â  Â  Â  Â  Â  Â  elIngresos.historyList.innerHTML = '';

Â  Â  Â  Â  Â  Â  if (appState.contributions.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.historyList.innerHTML = '<div style="text-align:center;color:var(--text-secondary);padding:20px;">ğŸŒ± Sin ingresos aÃºn.</div>';

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  [...appState.contributions].reverse().forEach(c => {

Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'history-item';

Â  Â  Â  Â  Â  Â  Â  Â  const d = new Date(c.date);

Â  Â  Â  Â  Â  Â  Â  Â  const dateString = `${d.toLocaleDateString('es-CO')} - ${d.toLocaleTimeString('es-CO', {hour: '2-digit', minute: '2-digit'})}`;

Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="history-date">ğŸ“… ${dateString}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="history-amount">${formatUSD(c.amountUSD)} <span class="history-rate">(a ${c.exchangeRate ? c.exchangeRate.toFixed(2) : 'N/A'})</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="history-amount" style="color:var(--accent-green-medium);">${formatCOP(c.amountCOP)}</div>`;

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.historyList.appendChild(item);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â  function updateMonthlyGoalsDisplay_Ingresos() {

Â  Â  Â  Â  Â  Â  if (!elIngresos.monthlyGoalsList) return;

Â  Â  Â  Â  Â  Â  const savingsByMonth = {};

Â  Â  Â  Â  Â  Â  appState.contributions.forEach(c => {

Â  Â  Â  Â  Â  Â  Â  Â  savingsByMonth[c.monthYear] = (savingsByMonth[c.monthYear] || 0) + c.amountCOP;

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  elIngresos.monthlyGoalsList.innerHTML = '';

Â  Â  Â  Â  Â  Â  const allMonths = new Set([...Object.keys(appState.monthlyTargets), ...Object.keys(savingsByMonth)]);

Â  Â  Â  Â  Â  Â  if (allMonths.size === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.monthlyGoalsList.innerHTML = '<div style="text-align:center;color:var(--text-secondary);padding:20px;">AÃºn no hay historial de meses.</div>';

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const sortedMonths = Array.from(allMonths).sort().reverse();

Â  Â  Â  Â  Â  Â  sortedMonths.forEach(monthYear => {

Â  Â  Â  Â  Â  Â  Â  Â  const savedThisMonth = savingsByMonth[monthYear] || 0;

Â  Â  Â  Â  Â  Â  Â  Â  const targetThisMonth = appState.monthlyTargets[monthYear] || DEFAULT_OVERALL_TARGET_COP;

Â  Â  Â  Â  Â  Â  Â  Â  const [year, month] = monthYear.split('-');

Â  Â  Â  Â  Â  Â  Â  Â  const monthName = new Date(year, month - 1).toLocaleString('es-CO', { month: 'long', year: 'numeric' });

Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'monthly-goal-item';

Â  Â  Â  Â  Â  Â  Â  Â  let statusText, statusClass;

Â  Â  Â  Â  Â  Â  Â  Â  Â if (savedThisMonth >= targetThisMonth && targetThisMonth > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText = `âœ… Â¡Cumplido! (${formatCOP(savedThisMonth)} de ${formatCOP(targetThisMonth)})`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusClass = 'achieved';

Â  Â  Â  Â  Â  Â  Â  Â  Â } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText = `â³ En Progreso (${formatCOP(savedThisMonth)} de ${formatCOP(targetThisMonth)})`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusClass = 'pending';

Â  Â  Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `<div class="monthly-goal-month">${monthName}</div><div class="monthly-goal-status ${statusClass}">${statusText}</div>`;

Â  Â  Â  Â  Â  Â  Â  Â  elIngresos.monthlyGoalsList.appendChild(item);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â  function updateCurrentMonthDisplayDOM_Ingresos() {

Â  Â  Â  Â  Â  Â  const now = new Date();

Â  Â  Â  Â  Â  Â  const monthName = now.toLocaleString('es-CO', { month: 'long' });

Â  Â  Â  Â  Â  Â  elIngresos.currentMonthDisplay.textContent = `ğŸ—“ï¸ ${monthName.charAt(0).toUpperCase() + monthName.slice(1)} de ${now.getFullYear()}`;

Â  Â  Â  Â  }

Â  Â  Â  Â  async function clearHistory_Ingresos() {

Â  Â  Â  Â  Â  Â  if (confirm('ğŸ¤” Â¿EstÃ¡s seguro de que quieres limpiar TODO el historial de ingresos para TODOS los usuarios? Esta acciÃ³n es irreversible.')) {

Â  Â  Â  Â  Â  Â  Â  Â  appState.contributions = [];

Â  Â  Â  Â  Â  Â  Â  Â  appState.monthlyTargets = {};

Â  Â  Â  Â  Â  Â  Â  Â  await saveSharedDataToFirestore();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  function renderTimetable() {

Â  Â  Â  Â  Â  Â  const grid = document.getElementById('timetableGrid');

Â  Â  Â  Â  Â  Â  if(!grid) return;

Â  Â  Â  Â  Â  Â  grid.innerHTML = '';

Â  Â  Â  Â  Â  Â  const corner = document.createElement('div');

Â  Â  Â  Â  Â  Â  corner.className = 'timetable-grid-corner';

Â  Â  Â  Â  Â  Â  grid.appendChild(corner);

Â  Â  Â  Â  Â  Â  TIMETABLE_DAYS.forEach((day, i) => {

Â  Â  Â  Â  Â  Â  Â  Â  const header = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  header.className = 'timetable-grid-header';

Â  Â  Â  Â  Â  Â  Â  Â  header.textContent = day;

Â  Â  Â  Â  Â  Â  Â  Â  header.style.gridColumn = i + 2;

Â  Â  Â  Â  Â  Â  Â  Â  grid.appendChild(header);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  for (let hour = TIMETABLE_START_HOUR; hour <= TIMETABLE_END_HOUR; hour++) {

Â  Â  Â  Â  Â  Â  Â  Â  const timeLabel = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  timeLabel.className = 'timetable-grid-time-label';

Â  Â  Â  Â  Â  Â  Â  Â  timeLabel.textContent = `${String(hour).padStart(2, '0')}:00`;

Â  Â  Â  Â  Â  Â  Â  Â  timeLabel.style.gridRow = hour - TIMETABLE_START_HOUR + 2;

Â  Â  Â  Â  Â  Â  Â  Â  grid.appendChild(timeLabel);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  appState.timetableData.forEach(event => {

Â  Â  Â  Â  Â  Â  Â  Â  const eventDiv = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  eventDiv.className = 'timetable-grid-event';

Â  Â  Â  Â  Â  Â  Â  Â  eventDiv.dataset.eventId = event.id;

Â  Â  Â  Â  Â  Â  Â  Â  eventDiv.style.backgroundColor = event.color || DEFAULT_EVENT_COLOR;

Â  Â  Â  Â  Â  Â  Â  Â  eventDiv.innerHTML = `<span class="subject-name">${event.subject}</span><span class="teacher-name">${event.teacher || ''}</span>`;

Â  Â  Â  Â  Â  Â  Â  Â  eventDiv.addEventListener('click', () => openEventModal('timetable', event.id));

Â  Â  Â  Â  Â  Â  Â  Â  const dayIndex = TIMETABLE_DAYS.indexOf(event.day.toUpperCase());

Â  Â  Â  Â  Â  Â  Â  Â  if (dayIndex === -1) return;

Â  Â  Â  Â  Â  Â  Â  Â  eventDiv.style.gridColumn = dayIndex + 2;

Â  Â  Â  Â  Â  Â  Â  Â  const startRow = parseInt(event.startTime.split(':')[0]) - TIMETABLE_START_HOUR + 2;

Â  Â  Â  Â  Â  Â  Â  Â  const endRow = parseInt(event.endTime.split(':')[0]) - TIMETABLE_START_HOUR + 2;

Â  Â  Â  Â  Â  Â  Â  Â  eventDiv.style.gridRow = `${startRow} / ${endRow}`;

Â  Â  Â  Â  Â  Â  Â  Â  grid.appendChild(eventDiv);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â  function initializeMainCalendar() {

Â  Â  Â  Â  Â  Â  const calendarEl = document.getElementById('mainCalendar');

Â  Â  Â  Â  Â  Â  if (!calendarEl || mainCalendarInstance) return;

Â  Â  Â  Â  Â  Â  mainCalendarInstance = new FullCalendar.Calendar(calendarEl, {

Â  Â  Â  Â  Â  Â  Â  Â  locale: 'es',

Â  Â  Â  Â  Â  Â  Â  Â  initialView: 'dayGridMonth',

Â  Â  Â  Â  Â  Â  Â  Â  headerToolbar: {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  left: 'prev,next today',Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  center: 'title',Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  right: ''

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  events: (fetchInfo, successCallback) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  successCallback(appState.calendarEventsData);

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  eventClick: (info) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  openEventModal('calendar', info.event.id);

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  select: (info) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  openEventModal('calendar', null, info.startStr);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mainCalendarInstance.unselect();

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  selectable: true,

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  mainCalendarInstance.render();

Â  Â  Â  Â  }

Â  Â  Â  Â  function updateTodayTasksList(){

Â  Â  Â  Â  Â  Â  const todayStr = new Date().toISOString().slice(0, 10);

Â  Â  Â  Â  Â  Â  const tasksListEl = document.getElementById('today-tasks-list');

Â  Â  Â  Â  Â  Â  if (!tasksListEl) return;

Â  Â  Â  Â  Â  Â  tasksListEl.innerHTML = '';

Â  Â  Â  Â  Â  Â  const todayEvents = appState.calendarEventsData.filter(event => event.start.slice(0, 10) === todayStr);

Â  Â  Â  Â  Â  Â  if (todayEvents.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  todayEvents.forEach(event => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.textContent = event.title;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.style.color = event.color;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.style.borderLeft = `3px solid ${event.color}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.style.paddingLeft = '8px';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  li.style.marginBottom = '5px';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasksListEl.appendChild(li);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  tasksListEl.innerHTML = '<li style="color: var(--text-secondary);">No hay actividades programadas para hoy.</li>';

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  function openEventModal(type, id = null, dateStr = null) {

Â  Â  Â  Â  Â  Â  currentEditingEventType = type;

Â  Â  Â  Â  Â  Â  currentEditingEventId = id;

Â  Â  Â  Â  Â  Â  eventForm.reset();

Â  Â  Â  Â  Â  Â  modalEventIdInput.value = id || '';

Â  Â  Â  Â  Â  Â  modalEventTypeInput.value = type;

Â  Â  Â  Â  Â  Â  modalTimetableFields.style.display = (type === 'timetable') ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  modalCalendarFields.style.display = (type === 'calendar') ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  modalEventStartDateInput.required = (type === 'calendar');

Â  Â  Â  Â  Â  Â  eventModalTitle.textContent = id ? `Editar ${type === 'timetable' ? 'Clase' : 'Actividad'}` : `AÃ±adir Nueva ${type === 'timetable' ? 'Clase' : 'Actividad'}`;

Â  Â  Â  Â  Â  Â  modalEventColorSelect.innerHTML = '';

Â  Â  Â  Â  Â  Â  PRESET_PASTEL_COLORS.forEach(colorObj => {

Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');

Â  Â  Â  Â  Â  Â  Â  Â  option.value = colorObj.value;

Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = colorObj.name;

Â  Â  Â  Â  Â  Â  Â  Â  modalEventColorSelect.appendChild(option);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (type === 'timetable') {

Â  Â  Â  Â  Â  Â  Â  Â  modalEventDaySelect.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  TIMETABLE_DAYS.forEach(d => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const o = document.createElement('option');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  o.value = d; o.textContent = d;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventDaySelect.appendChild(o);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  populateTimeSelect(modalEventStartTimeSelect, TIMETABLE_START_HOUR, TIMETABLE_END_HOUR);

Â  Â  Â  Â  Â  Â  Â  Â  populateTimeSelect(modalEventEndTimeSelect, TIMETABLE_START_HOUR, TIMETABLE_END_HOUR, null, true);

Â  Â  Â  Â  Â  Â  Â  Â  if (id) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const event = appState.timetableData.find(e => e.id === id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventTitleInput.value = event.subject;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventTeacherInput.value = event.teacher || '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventDaySelect.value = event.day;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventStartTimeSelect.value = event.startTime;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventEndTimeSelect.value = event.endTime;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventColorSelect.value = event.color || DEFAULT_EVENT_COLOR;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else { // calendar

Â  Â  Â  Â  Â  Â  Â  Â  modalEventStartDateInput.value = dateStr ? dateStr.slice(0, 10) : new Date().toISOString().slice(0, 10);

Â  Â  Â  Â  Â  Â  Â  Â  if (id) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const event = appState.calendarEventsData.find(e => e.id === id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventTitleInput.value = event.title;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventStartDateInput.value = event.start.slice(0, 10);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modalEventColorSelect.value = event.color || DEFAULT_EVENT_COLOR;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  deleteEventBtn.style.display = id ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  eventModalOverlay.classList.add('active');

Â  Â  Â  Â  }

Â  Â  Â  Â  function closeEventModal() {

Â  Â  Â  Â  Â  Â  eventModalOverlay.classList.remove('active');

Â  Â  Â  Â  }

Â  Â  Â  Â  function populateTimeSelect(selectElement, startHour, endHour, selectedValue = null, isEndTime = false) {

Â  Â  Â  Â  Â  Â  selectElement.innerHTML = '';

Â  Â  Â  Â  Â  Â  const limit = isEndTime ? endHour + 1 : endHour;

Â  Â  Â  Â  Â  Â  for (let h = startHour; h <= limit; h++) {

Â  Â  Â  Â  Â  Â  Â  Â  const timeStr = `${String(h).padStart(2, '0')}:00`;

Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');

Â  Â  Â  Â  Â  Â  Â  Â  option.value = timeStr;

Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = timeStr;

Â  Â  Â  Â  Â  Â  Â  Â  if (timeStr === selectedValue) option.selected = true;

Â  Â  Â  Â  Â  Â  Â  Â  selectElement.appendChild(option);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â  function initializeApp() {Â 

Â  Â  Â  Â  Â  Â  showPage('calendario-page');

Â  Â  Â  Â  Â  Â  updateCurrentMonthDisplayDOM_Ingresos();

Â  Â  Â  Â  Â  Â  initializeMainCalendar();

Â  Â  Â  Â  Â  Â  getDailyExchangeRate_Ingresos();Â 

Â  Â  Â  Â  Â  Â  updateMonthlyTimeProgress();

Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-button').forEach(b => b.addEventListener('click', () => showPage(b.dataset.page)));

Â  Â  Â  Â  Â  Â  if(elIngresos.addMoneyButton) elIngresos.addMoneyButton.addEventListener('click', addMoney_Ingresos);Â 

Â  Â  Â  Â  Â  Â  if(elIngresos.clearHistoryButton) elIngresos.clearHistoryButton.addEventListener('click', clearHistory_Ingresos);

Â  Â  Â  Â  Â  Â  addCalendarEventBtn.addEventListener('click', () => openEventModal('calendar'));

Â  Â  Â  Â  Â  Â  addTimetableEventBtnGlobal.addEventListener('click', () => openEventModal('timetable'));

Â  Â  Â  Â  Â  Â  cancelEventBtn.addEventListener('click', closeEventModal);

Â  Â  Â  Â  Â  Â  eventForm.addEventListener('submit', async function(e) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  const id = modalEventIdInput.value;

Â  Â  Â  Â  Â  Â  Â  Â  const type = modalEventTypeInput.value;

Â  Â  Â  Â  Â  Â  Â  Â  const title = modalEventTitleInput.value.trim();

Â  Â  Â  Â  Â  Â  Â  Â  const color = modalEventColorSelect.value;

Â  Â  Â  Â  Â  Â  Â  Â  if (!title) return alert("El tÃ­tulo es obligatorio.");

Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'timetable') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newEvent = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: id || 'tt_' + Date.now(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subject: title,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  teacher: modalEventTeacherInput.value,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  day: modalEventDaySelect.value,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startTime: modalEventStartTimeSelect.value,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  endTime: modalEventEndTimeSelect.value,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(id) appState.timetableData = appState.timetableData.map(e => e.id === id ? newEvent : e);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else appState.timetableData.push(newEvent);

Â  Â  Â  Â  Â  Â  Â  Â  } else { // calendar

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newEvent = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: id || 'cal_' + Date.now(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  start: modalEventStartDateInput.value,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allDay: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(id) appState.calendarEventsData = appState.calendarEventsData.map(e => e.id === id ? newEvent : e);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else appState.calendarEventsData.push(newEvent);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  await saveSharedDataToFirestore();

Â  Â  Â  Â  Â  Â  Â  Â  closeEventModal();

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  deleteEventBtn.addEventListener('click', async function() {

Â  Â  Â  Â  Â  Â  Â  Â  const id = modalEventIdInput.value;

Â  Â  Â  Â  Â  Â  Â  Â  const type = modalEventTypeInput.value;

Â  Â  Â  Â  Â  Â  Â  Â  if (!id) return;

Â  Â  Â  Â  Â  Â  Â  Â  if (confirm('Â¿Seguro que quieres eliminar este evento?')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'timetable') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appState.timetableData = appState.timetableData.filter(e => e.id !== id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appState.calendarEventsData = appState.calendarEventsData.filter(e => e.id !== id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await saveSharedDataToFirestore();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeEventModal();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â elIngresos.overallTargetInput.addEventListener('change', async () => {

Â  Â  Â  Â  Â  Â  Â  Â  const newTarget = parseFloat(elIngresos.overallTargetInput.value);

Â  Â  Â  Â  Â  Â  Â  Â  if (!isNaN(newTarget) && newTarget > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentMonthKey = `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appState.monthlyTargets[currentMonthKey] = newTarget;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await saveSharedDataToFirestore();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â elIngresos.currencySelector.addEventListener('change', (event) => {

Â  Â  Â  Â  Â  Â  Â  Â  appState.selectedInputCurrencyIngresos = event.target.value;

Â  Â  Â  Â  Â  Â  Â  Â  saveSharedDataToFirestore();

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  Â  Â  initializeApp();

Â  Â  Â  Â  Â  Â  loadSharedDataFromFirestore();

Â  Â  Â  Â  });

Â  Â  </script>

</body>

</html>
